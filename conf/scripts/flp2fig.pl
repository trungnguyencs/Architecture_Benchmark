#!/usr/bin/perl

# Plot program based on HotSpot tofig.pl

use Getopt::Long;
use strict;

my $op_fontsize = 10;
my $op_temp;
my $op_help;

my $result = GetOptions("font=i",\$op_fontsize,
                        "temp=s",\$op_temp,
                        "help",\$op_help
                       );

sub processParams {
    my $badparams =0;

    if( @ARGV < 1) {
        print "Provide at least one datafile file for input\n";
        $badparams = 1;
    }

    if( $badparams ) {
        print "usage:\nflp2fig <options> <floorplan.flp>\n";
        print "\tOptions:\n";
        print "\t-temp=s                ; Temperature trace file\n";
        print "\t-font=i                ; Font size\n";
        print "\t-help                  ; Show this help\n";
        exit;
    }
}

my $temp7 = 110;
my $temp6 = 100;
my $temp5 = 90;
my $temp4 = 80;
my $temp3 = 70;
my $temp2 = 60;
my $temp1 = 50;

sub calcColor {
    my $temp = shift;

    my $maxColor = 360; # 100 or higher
    my $minColor = 170;  #  50 or lower
    
    # 170 ... 371
#    $temp -= 273.15;

    if ($temp > $temp7) {
	$temp = $maxColor;
    }elsif ($temp < $temp1) {
	$temp = $minColor;
    }else{
	my $scale = ($maxColor-$minColor)/60;
	$temp = int($scale*($temp-$temp1))+$minColor;
    }

    return $temp;
}

my %moduleMaxTemp;

sub getTemperatures {

    return unless ($op_temp);

    open(FILE,"<${op_temp}") or die("error: could not open temperature trace");

    my @nameLine = split(/[ \t\n]+/,<FILE>);
    my @max;
    
    while(<FILE>){
	chop();
        my @line = split(/[ \t]+/,$_);

        for(my $i=0; $i<@line ; $i++ ) {
# 	    if ($line[$i] > $max[$i]) {
# 		printf STDERR $nameLine[$i] . ":" . $max[$i] . ":\n";
# 	    }
	    $max[$i] = $line[$i] if ($line[$i] > $max[$i]);
	}
    }

    for(my $i=0; $i<@nameLine ; $i++ ) {
	$moduleMaxTemp{$nameLine[$i]} = $max[$i];
	printf STDERR  $nameLine[$i] . " " .  $moduleMaxTemp{$nameLine[$i]} . "C\n";
    }

    close(FILE);
}

processParams();
getTemperatures();
exit &main();

sub dumpHeader {

print <<"EOF1";
0 170 #0000ff
0 171 #0004fb
0 172 #0008f7
0 173 #000cf3
0 174 #0010ef
0 175 #0014eb
0 176 #0018e7
0 177 #001ce3
0 178 #0020df
0 179 #0024db
0 180 #0028d7
0 181 #002cd3
0 182 #0030cf
0 183 #0034cb
0 184 #0038c7
0 185 #003cc3
0 186 #0040bf
0 187 #0044bb
0 188 #0048b7
0 189 #004cb3
0 190 #0050af
0 191 #0054ab
0 192 #0058a7
0 193 #005ca3
0 194 #00609f
0 195 #00649b
0 196 #006897
0 197 #006c93
0 198 #00708f
0 199 #00748b
0 200 #007887
0 201 #007c83
0 202 #00807f
0 203 #00847b
0 204 #008877
0 205 #008c73
0 206 #00906f
0 207 #00946b
0 208 #009867
0 209 #009c63
0 210 #00a05f
0 211 #00a45b
0 212 #00a857
0 213 #00ac53
0 214 #00b04f
0 215 #00b44b
0 216 #00b847
0 217 #00bc43
0 218 #00c03f
0 219 #00c43b
0 220 #00c837
0 221 #00cc33
0 222 #00d02f
0 223 #00d42b
0 224 #00d827
0 225 #00dc23
0 226 #00e01f
0 227 #00e41b
0 228 #00e817
0 229 #00ec13
0 230 #00f00f
0 231 #00f40b
0 232 #00f807
0 233 #00fc03
0 234 #00ff00
0 235 #04ff00
0 236 #08ff00
0 237 #0cff00
0 238 #10ff00
0 239 #14ff00
0 240 #18ff00
0 241 #1cff00
0 242 #20ff00
0 243 #24ff00
0 244 #28ff00
0 245 #2cff00
0 246 #30ff00
0 247 #34ff00
0 248 #38ff00
0 249 #3cff00
0 250 #40ff00
0 251 #44ff00
0 252 #48ff00
0 253 #4cff00
0 254 #50ff00
0 255 #54ff00
0 256 #58ff00
0 257 #5cff00
0 258 #60ff00
0 259 #64ff00
0 260 #68ff00
0 261 #6cff00
0 262 #70ff00
0 263 #74ff00
0 264 #78ff00
0 265 #7cff00
0 266 #80ff00
0 267 #84ff00
0 268 #88ff00
0 269 #8cff00
0 270 #90ff00
0 271 #94ff00
0 272 #98ff00
0 273 #9cff00
0 274 #a0ff00
0 275 #a4ff00
0 276 #a8ff00
0 277 #acff00
0 278 #b0ff00
0 279 #b4ff00
0 280 #b8ff00
0 281 #bcff00
0 282 #c0ff00
0 283 #c4ff00
0 284 #c8ff00
0 285 #ccff00
0 286 #d0ff00
0 287 #d4ff00
0 288 #d8ff00
0 289 #dcff00
0 290 #e0ff00
0 291 #e4ff00
0 292 #e8ff00
0 293 #ecff00
0 294 #f0ff00
0 295 #f4ff00
0 296 #f8ff00
0 297 #fcff00
0 298 #ffff00
0 299 #fffb00
0 300 #fff700
0 301 #fff300
0 302 #ffef00
0 303 #ffeb00
0 304 #ffe700
0 305 #ffe300
0 306 #ffdf00
0 307 #ffdb00
0 308 #ffd700
0 309 #ffd300
0 310 #ffcf00
0 311 #ffcb00
0 312 #ffc700
0 313 #ffc300
0 314 #ffbf00
0 315 #ffbb00
0 316 #ffb700
0 317 #ffb300
0 318 #ffaf00
0 319 #ffab00
0 320 #ffa700
0 321 #ffa300
0 322 #ff9f00
0 323 #ff9b00
0 324 #ff9700
0 325 #ff9300
0 326 #ff8f00
0 327 #ff8b00
0 328 #ff8700
0 329 #ff8300
0 330 #ff7f00
0 331 #ff7b00
0 332 #ff7700
0 333 #ff7300
0 334 #ff6f00
0 335 #ff6b00
0 336 #ff6700
0 337 #ff6300
0 338 #ff5f00
0 339 #ff5b00
0 340 #ff5700
0 341 #ff5300
0 342 #ff4f00
0 343 #ff4b00
0 344 #ff4700
0 345 #ff4300
0 346 #ff3f00
0 347 #ff3b00
0 348 #ff3700
0 349 #ff3300
0 350 #ff2f00
0 351 #ff2b00
0 352 #ff2700
0 353 #ff2300
0 354 #ff1f00
0 355 #ff1b00
0 356 #ff1700
0 357 #ff1300
0 358 #ff0f00
0 359 #ff0b00
0 360 #ff0700
0 361 #ff0300
2 3 0 0 361 361 10 0 20 0.000 0 0 0 0 0 5
    9748 2683 9967 2683 9967 2691 9748 2691 9748 2683
2 3 0 0 360 360 10 0 20 0.000 0 0 0 0 0 5
    9748 2691 9967 2691 9967 2699 9748 2699 9748 2691
2 3 0 0 359 359 10 0 20 0.000 0 0 0 0 0 5
    9748 2699 9967 2699 9967 2707 9748 2707 9748 2699
2 3 0 0 358 358 10 0 20 0.000 0 0 0 0 0 5
    9748 2707 9967 2707 9967 2715 9748 2715 9748 2707
2 3 0 0 357 357 10 0 20 0.000 0 0 0 0 0 5
    9748 2715 9967 2715 9967 2723 9748 2723 9748 2715
2 3 0 0 356 356 10 0 20 0.000 0 0 0 0 0 5
    9748 2723 9967 2723 9967 2731 9748 2731 9748 2723
2 3 0 0 355 355 10 0 20 0.000 0 0 0 0 0 5
    9748 2731 9967 2731 9967 2739 9748 2739 9748 2731
2 3 0 0 354 354 10 0 20 0.000 0 0 0 0 0 5
    9748 2739 9967 2739 9967 2747 9748 2747 9748 2739
2 3 0 0 353 353 10 0 20 0.000 0 0 0 0 0 5
    9748 2747 9967 2747 9967 2755 9748 2755 9748 2747
2 3 0 0 352 352 10 0 20 0.000 0 0 0 0 0 5
    9748 2755 9967 2755 9967 2763 9748 2763 9748 2755
2 3 0 0 351 351 10 0 20 0.000 0 0 0 0 0 5
    9748 2763 9967 2763 9967 2771 9748 2771 9748 2763
2 3 0 0 350 350 10 0 20 0.000 0 0 0 0 0 5
    9748 2771 9967 2771 9967 2779 9748 2779 9748 2771
2 3 0 0 349 349 10 0 20 0.000 0 0 0 0 0 5
    9748 2779 9967 2779 9967 2787 9748 2787 9748 2779
2 3 0 0 348 348 10 0 20 0.000 0 0 0 0 0 5
    9748 2787 9967 2787 9967 2795 9748 2795 9748 2787
2 3 0 0 347 347 10 0 20 0.000 0 0 0 0 0 5
    9748 2795 9967 2795 9967 2803 9748 2803 9748 2795
2 3 0 0 346 346 10 0 20 0.000 0 0 0 0 0 5
    9748 2803 9967 2803 9967 2811 9748 2811 9748 2803
2 3 0 0 345 345 10 0 20 0.000 0 0 0 0 0 5
    9748 2811 9967 2811 9967 2819 9748 2819 9748 2811
2 3 0 0 344 344 10 0 20 0.000 0 0 0 0 0 5
    9748 2819 9967 2819 9967 2827 9748 2827 9748 2819
2 3 0 0 343 343 10 0 20 0.000 0 0 0 0 0 5
    9748 2827 9967 2827 9967 2835 9748 2835 9748 2827
2 3 0 0 342 342 10 0 20 0.000 0 0 0 0 0 5
    9748 2835 9967 2835 9967 2843 9748 2843 9748 2835
2 3 0 0 341 341 10 0 20 0.000 0 0 0 0 0 5
    9748 2843 9967 2843 9967 2851 9748 2851 9748 2843
2 3 0 0 340 340 10 0 20 0.000 0 0 0 0 0 5
    9748 2851 9967 2851 9967 2859 9748 2859 9748 2851
2 3 0 0 339 339 10 0 20 0.000 0 0 0 0 0 5
    9748 2859 9967 2859 9967 2867 9748 2867 9748 2859
2 3 0 0 338 338 10 0 20 0.000 0 0 0 0 0 5
    9748 2867 9967 2867 9967 2875 9748 2875 9748 2867
2 3 0 0 337 337 10 0 20 0.000 0 0 0 0 0 5
    9748 2875 9967 2875 9967 2883 9748 2883 9748 2875
2 3 0 0 336 336 10 0 20 0.000 0 0 0 0 0 5
    9748 2883 9967 2883 9967 2891 9748 2891 9748 2883
2 3 0 0 335 335 10 0 20 0.000 0 0 0 0 0 5
    9748 2891 9967 2891 9967 2899 9748 2899 9748 2891
2 3 0 0 334 334 10 0 20 0.000 0 0 0 0 0 5
    9748 2899 9967 2899 9967 2907 9748 2907 9748 2899
2 3 0 0 333 333 10 0 20 0.000 0 0 0 0 0 5
    9748 2907 9967 2907 9967 2915 9748 2915 9748 2907
2 3 0 0 332 332 10 0 20 0.000 0 0 0 0 0 5
    9748 2915 9967 2915 9967 2923 9748 2923 9748 2915
2 3 0 0 331 331 10 0 20 0.000 0 0 0 0 0 5
    9748 2923 9967 2923 9967 2931 9748 2931 9748 2923
2 3 0 0 330 330 10 0 20 0.000 0 0 0 0 0 5
    9748 2931 9967 2931 9967 2939 9748 2939 9748 2931
2 3 0 0 329 329 10 0 20 0.000 0 0 0 0 0 5
    9748 2939 9967 2939 9967 2947 9748 2947 9748 2939
2 3 0 0 328 328 10 0 20 0.000 0 0 0 0 0 5
    9748 2947 9967 2947 9967 2955 9748 2955 9748 2947
2 3 0 0 327 327 10 0 20 0.000 0 0 0 0 0 5
    9748 2955 9967 2955 9967 2963 9748 2963 9748 2955
2 3 0 0 326 326 10 0 20 0.000 0 0 0 0 0 5
    9748 2963 9967 2963 9967 2971 9748 2971 9748 2963
2 3 0 0 325 325 10 0 20 0.000 0 0 0 0 0 5
    9748 2971 9967 2971 9967 2979 9748 2979 9748 2971
2 3 0 0 324 324 10 0 20 0.000 0 0 0 0 0 5
    9748 2979 9967 2979 9967 2987 9748 2987 9748 2979
2 3 0 0 323 323 10 0 20 0.000 0 0 0 0 0 5
    9748 2987 9967 2987 9967 2995 9748 2995 9748 2987
2 3 0 0 322 322 10 0 20 0.000 0 0 0 0 0 5
    9748 2995 9967 2995 9967 3003 9748 3003 9748 2995
2 3 0 0 321 321 10 0 20 0.000 0 0 0 0 0 5
    9748 3003 9967 3003 9967 3011 9748 3011 9748 3003
2 3 0 0 320 320 10 0 20 0.000 0 0 0 0 0 5
    9748 3011 9967 3011 9967 3019 9748 3019 9748 3011
2 3 0 0 319 319 10 0 20 0.000 0 0 0 0 0 5
    9748 3019 9967 3019 9967 3027 9748 3027 9748 3019
2 3 0 0 318 318 10 0 20 0.000 0 0 0 0 0 5
    9748 3027 9967 3027 9967 3035 9748 3035 9748 3027
2 3 0 0 317 317 10 0 20 0.000 0 0 0 0 0 5
    9748 3035 9967 3035 9967 3043 9748 3043 9748 3035
2 3 0 0 316 316 10 0 20 0.000 0 0 0 0 0 5
    9748 3043 9967 3043 9967 3051 9748 3051 9748 3043
2 3 0 0 315 315 10 0 20 0.000 0 0 0 0 0 5
    9748 3051 9967 3051 9967 3059 9748 3059 9748 3051
2 3 0 0 314 314 10 0 20 0.000 0 0 0 0 0 5
    9748 3059 9967 3059 9967 3067 9748 3067 9748 3059
2 3 0 0 313 313 10 0 20 0.000 0 0 0 0 0 5
    9748 3067 9967 3067 9967 3075 9748 3075 9748 3067
2 3 0 0 312 312 10 0 20 0.000 0 0 0 0 0 5
    9748 3075 9967 3075 9967 3083 9748 3083 9748 3075
2 3 0 0 311 311 10 0 20 0.000 0 0 0 0 0 5
    9748 3083 9967 3083 9967 3091 9748 3091 9748 3083
2 3 0 0 310 310 10 0 20 0.000 0 0 0 0 0 5
    9748 3091 9967 3091 9967 3099 9748 3099 9748 3091
2 3 0 0 309 309 10 0 20 0.000 0 0 0 0 0 5
    9748 3099 9967 3099 9967 3107 9748 3107 9748 3099
2 3 0 0 308 308 10 0 20 0.000 0 0 0 0 0 5
    9748 3107 9967 3107 9967 3115 9748 3115 9748 3107
2 3 0 0 307 307 10 0 20 0.000 0 0 0 0 0 5
    9748 3115 9967 3115 9967 3123 9748 3123 9748 3115
2 3 0 0 306 306 10 0 20 0.000 0 0 0 0 0 5
    9748 3123 9967 3123 9967 3131 9748 3131 9748 3123
2 3 0 0 305 305 10 0 20 0.000 0 0 0 0 0 5
    9748 3131 9967 3131 9967 3139 9748 3139 9748 3131
2 3 0 0 304 304 10 0 20 0.000 0 0 0 0 0 5
    9748 3139 9967 3139 9967 3147 9748 3147 9748 3139
2 3 0 0 303 303 10 0 20 0.000 0 0 0 0 0 5
    9748 3147 9967 3147 9967 3155 9748 3155 9748 3147
2 3 0 0 302 302 10 0 20 0.000 0 0 0 0 0 5
    9748 3155 9967 3155 9967 3163 9748 3163 9748 3155
2 3 0 0 301 301 10 0 20 0.000 0 0 0 0 0 5
    9748 3163 9967 3163 9967 3171 9748 3171 9748 3163
2 3 0 0 300 300 10 0 20 0.000 0 0 0 0 0 5
    9748 3171 9967 3171 9967 3179 9748 3179 9748 3171
2 3 0 0 299 299 10 0 20 0.000 0 0 0 0 0 5
    9748 3179 9967 3179 9967 3187 9748 3187 9748 3179
2 3 0 0 298 298 10 0 20 0.000 0 0 0 0 0 5
    9748 3187 9967 3187 9967 3195 9748 3195 9748 3187
2 3 0 0 297 297 10 0 20 0.000 0 0 0 0 0 5
    9748 3195 9967 3195 9967 3203 9748 3203 9748 3195
2 3 0 0 296 296 10 0 20 0.000 0 0 0 0 0 5
    9748 3203 9967 3203 9967 3211 9748 3211 9748 3203
2 3 0 0 295 295 10 0 20 0.000 0 0 0 0 0 5
    9748 3211 9967 3211 9967 3219 9748 3219 9748 3211
2 3 0 0 294 294 10 0 20 0.000 0 0 0 0 0 5
    9748 3219 9967 3219 9967 3227 9748 3227 9748 3219
2 3 0 0 293 293 10 0 20 0.000 0 0 0 0 0 5
    9748 3227 9967 3227 9967 3235 9748 3235 9748 3227
2 3 0 0 292 292 10 0 20 0.000 0 0 0 0 0 5
    9748 3235 9967 3235 9967 3243 9748 3243 9748 3235
2 3 0 0 291 291 10 0 20 0.000 0 0 0 0 0 5
    9748 3243 9967 3243 9967 3251 9748 3251 9748 3243
2 3 0 0 290 290 10 0 20 0.000 0 0 0 0 0 5
    9748 3251 9967 3251 9967 3259 9748 3259 9748 3251
2 3 0 0 289 289 10 0 20 0.000 0 0 0 0 0 5
    9748 3259 9967 3259 9967 3267 9748 3267 9748 3259
2 3 0 0 288 288 10 0 20 0.000 0 0 0 0 0 5
    9748 3267 9967 3267 9967 3275 9748 3275 9748 3267
2 3 0 0 287 287 10 0 20 0.000 0 0 0 0 0 5
    9748 3275 9967 3275 9967 3283 9748 3283 9748 3275
2 3 0 0 286 286 10 0 20 0.000 0 0 0 0 0 5
    9748 3283 9967 3283 9967 3291 9748 3291 9748 3283
2 3 0 0 285 285 10 0 20 0.000 0 0 0 0 0 5
    9748 3291 9967 3291 9967 3299 9748 3299 9748 3291
2 3 0 0 284 284 10 0 20 0.000 0 0 0 0 0 5
    9748 3299 9967 3299 9967 3307 9748 3307 9748 3299
2 3 0 0 283 283 10 0 20 0.000 0 0 0 0 0 5
    9748 3307 9967 3307 9967 3315 9748 3315 9748 3307
2 3 0 0 282 282 10 0 20 0.000 0 0 0 0 0 5
    9748 3315 9967 3315 9967 3323 9748 3323 9748 3315
2 3 0 0 281 281 10 0 20 0.000 0 0 0 0 0 5
    9748 3323 9967 3323 9967 3331 9748 3331 9748 3323
2 3 0 0 280 280 10 0 20 0.000 0 0 0 0 0 5
    9748 3331 9967 3331 9967 3339 9748 3339 9748 3331
2 3 0 0 279 279 10 0 20 0.000 0 0 0 0 0 5
    9748 3339 9967 3339 9967 3347 9748 3347 9748 3339
2 3 0 0 278 278 10 0 20 0.000 0 0 0 0 0 5
    9748 3347 9967 3347 9967 3355 9748 3355 9748 3347
2 3 0 0 277 277 10 0 20 0.000 0 0 0 0 0 5
    9748 3355 9967 3355 9967 3363 9748 3363 9748 3355
2 3 0 0 276 276 10 0 20 0.000 0 0 0 0 0 5
    9748 3363 9967 3363 9967 3371 9748 3371 9748 3363
2 3 0 0 275 275 10 0 20 0.000 0 0 0 0 0 5
    9748 3371 9967 3371 9967 3379 9748 3379 9748 3371
2 3 0 0 274 274 10 0 20 0.000 0 0 0 0 0 5
    9748 3379 9967 3379 9967 3387 9748 3387 9748 3379
2 3 0 0 273 273 10 0 20 0.000 0 0 0 0 0 5
    9748 3387 9967 3387 9967 3395 9748 3395 9748 3387
2 3 0 0 272 272 10 0 20 0.000 0 0 0 0 0 5
    9748 3395 9967 3395 9967 3403 9748 3403 9748 3395
2 3 0 0 271 271 10 0 20 0.000 0 0 0 0 0 5
    9748 3403 9967 3403 9967 3411 9748 3411 9748 3403
2 3 0 0 270 270 10 0 20 0.000 0 0 0 0 0 5
    9748 3411 9967 3411 9967 3419 9748 3419 9748 3411
2 3 0 0 269 269 10 0 20 0.000 0 0 0 0 0 5
    9748 3419 9967 3419 9967 3427 9748 3427 9748 3419
2 3 0 0 268 268 10 0 20 0.000 0 0 0 0 0 5
    9748 3427 9967 3427 9967 3435 9748 3435 9748 3427
2 3 0 0 267 267 10 0 20 0.000 0 0 0 0 0 5
    9748 3435 9967 3435 9967 3443 9748 3443 9748 3435
2 3 0 0 266 266 10 0 20 0.000 0 0 0 0 0 5
    9748 3443 9967 3443 9967 3451 9748 3451 9748 3443
2 3 0 0 265 265 10 0 20 0.000 0 0 0 0 0 5
    9748 3451 9967 3451 9967 3459 9748 3459 9748 3451
2 3 0 0 264 264 10 0 20 0.000 0 0 0 0 0 5
    9748 3459 9967 3459 9967 3467 9748 3467 9748 3459
2 3 0 0 263 263 10 0 20 0.000 0 0 0 0 0 5
    9748 3467 9967 3467 9967 3475 9748 3475 9748 3467
2 3 0 0 262 262 10 0 20 0.000 0 0 0 0 0 5
    9748 3475 9967 3475 9967 3483 9748 3483 9748 3475
2 3 0 0 261 261 10 0 20 0.000 0 0 0 0 0 5
    9748 3483 9967 3483 9967 3491 9748 3491 9748 3483
2 3 0 0 260 260 10 0 20 0.000 0 0 0 0 0 5
    9748 3491 9967 3491 9967 3499 9748 3499 9748 3491
2 3 0 0 259 259 10 0 20 0.000 0 0 0 0 0 5
    9748 3499 9967 3499 9967 3507 9748 3507 9748 3499
2 3 0 0 258 258 10 0 20 0.000 0 0 0 0 0 5
    9748 3507 9967 3507 9967 3515 9748 3515 9748 3507
2 3 0 0 257 257 10 0 20 0.000 0 0 0 0 0 5
    9748 3515 9967 3515 9967 3523 9748 3523 9748 3515
2 3 0 0 256 256 10 0 20 0.000 0 0 0 0 0 5
    9748 3523 9967 3523 9967 3531 9748 3531 9748 3523
2 3 0 0 255 255 10 0 20 0.000 0 0 0 0 0 5
    9748 3531 9967 3531 9967 3539 9748 3539 9748 3531
2 3 0 0 254 254 10 0 20 0.000 0 0 0 0 0 5
    9748 3539 9967 3539 9967 3547 9748 3547 9748 3539
2 3 0 0 253 253 10 0 20 0.000 0 0 0 0 0 5
    9748 3547 9967 3547 9967 3555 9748 3555 9748 3547
2 3 0 0 252 252 10 0 20 0.000 0 0 0 0 0 5
    9748 3555 9967 3555 9967 3563 9748 3563 9748 3555
2 3 0 0 251 251 10 0 20 0.000 0 0 0 0 0 5
    9748 3563 9967 3563 9967 3571 9748 3571 9748 3563
2 3 0 0 250 250 10 0 20 0.000 0 0 0 0 0 5
    9748 3571 9967 3571 9967 3579 9748 3579 9748 3571
2 3 0 0 249 249 10 0 20 0.000 0 0 0 0 0 5
    9748 3579 9967 3579 9967 3587 9748 3587 9748 3579
2 3 0 0 248 248 10 0 20 0.000 0 0 0 0 0 5
    9748 3587 9967 3587 9967 3595 9748 3595 9748 3587
2 3 0 0 247 247 10 0 20 0.000 0 0 0 0 0 5
    9748 3595 9967 3595 9967 3603 9748 3603 9748 3595
2 3 0 0 246 246 10 0 20 0.000 0 0 0 0 0 5
    9748 3603 9967 3603 9967 3611 9748 3611 9748 3603
2 3 0 0 245 245 10 0 20 0.000 0 0 0 0 0 5
    9748 3611 9967 3611 9967 3619 9748 3619 9748 3611
2 3 0 0 244 244 10 0 20 0.000 0 0 0 0 0 5
    9748 3619 9967 3619 9967 3627 9748 3627 9748 3619
2 3 0 0 243 243 10 0 20 0.000 0 0 0 0 0 5
    9748 3627 9967 3627 9967 3635 9748 3635 9748 3627
2 3 0 0 242 242 10 0 20 0.000 0 0 0 0 0 5
    9748 3635 9967 3635 9967 3643 9748 3643 9748 3635
2 3 0 0 241 241 10 0 20 0.000 0 0 0 0 0 5
    9748 3643 9967 3643 9967 3651 9748 3651 9748 3643
2 3 0 0 240 240 10 0 20 0.000 0 0 0 0 0 5
    9748 3651 9967 3651 9967 3659 9748 3659 9748 3651
2 3 0 0 239 239 10 0 20 0.000 0 0 0 0 0 5
    9748 3659 9967 3659 9967 3667 9748 3667 9748 3659
2 3 0 0 238 238 10 0 20 0.000 0 0 0 0 0 5
    9748 3667 9967 3667 9967 3675 9748 3675 9748 3667
2 3 0 0 237 237 10 0 20 0.000 0 0 0 0 0 5
    9748 3675 9967 3675 9967 3683 9748 3683 9748 3675
2 3 0 0 236 236 10 0 20 0.000 0 0 0 0 0 5
    9748 3683 9967 3683 9967 3691 9748 3691 9748 3683
2 3 0 0 235 235 10 0 20 0.000 0 0 0 0 0 5
    9748 3691 9967 3691 9967 3699 9748 3699 9748 3691
2 3 0 0 234 234 10 0 20 0.000 0 0 0 0 0 5
    9748 3699 9967 3699 9967 3707 9748 3707 9748 3699
2 3 0 0 233 233 10 0 20 0.000 0 0 0 0 0 5
    9748 3707 9967 3707 9967 3715 9748 3715 9748 3707
2 3 0 0 232 232 10 0 20 0.000 0 0 0 0 0 5
    9748 3715 9967 3715 9967 3723 9748 3723 9748 3715
2 3 0 0 231 231 10 0 20 0.000 0 0 0 0 0 5
    9748 3723 9967 3723 9967 3731 9748 3731 9748 3723
2 3 0 0 230 230 10 0 20 0.000 0 0 0 0 0 5
    9748 3731 9967 3731 9967 3739 9748 3739 9748 3731
2 3 0 0 229 229 10 0 20 0.000 0 0 0 0 0 5
    9748 3739 9967 3739 9967 3747 9748 3747 9748 3739
2 3 0 0 228 228 10 0 20 0.000 0 0 0 0 0 5
    9748 3747 9967 3747 9967 3755 9748 3755 9748 3747
2 3 0 0 227 227 10 0 20 0.000 0 0 0 0 0 5
    9748 3755 9967 3755 9967 3763 9748 3763 9748 3755
2 3 0 0 226 226 10 0 20 0.000 0 0 0 0 0 5
    9748 3763 9967 3763 9967 3771 9748 3771 9748 3763
2 3 0 0 225 225 10 0 20 0.000 0 0 0 0 0 5
    9748 3771 9967 3771 9967 3779 9748 3779 9748 3771
2 3 0 0 224 224 10 0 20 0.000 0 0 0 0 0 5
    9748 3779 9967 3779 9967 3787 9748 3787 9748 3779
2 3 0 0 223 223 10 0 20 0.000 0 0 0 0 0 5
    9748 3787 9967 3787 9967 3795 9748 3795 9748 3787
2 3 0 0 222 222 10 0 20 0.000 0 0 0 0 0 5
    9748 3795 9967 3795 9967 3803 9748 3803 9748 3795
2 3 0 0 221 221 10 0 20 0.000 0 0 0 0 0 5
    9748 3803 9967 3803 9967 3811 9748 3811 9748 3803
2 3 0 0 220 220 10 0 20 0.000 0 0 0 0 0 5
    9748 3811 9967 3811 9967 3819 9748 3819 9748 3811
2 3 0 0 219 219 10 0 20 0.000 0 0 0 0 0 5
    9748 3819 9967 3819 9967 3827 9748 3827 9748 3819
2 3 0 0 218 218 10 0 20 0.000 0 0 0 0 0 5
    9748 3827 9967 3827 9967 3835 9748 3835 9748 3827
2 3 0 0 217 217 10 0 20 0.000 0 0 0 0 0 5
    9748 3835 9967 3835 9967 3843 9748 3843 9748 3835
2 3 0 0 216 216 10 0 20 0.000 0 0 0 0 0 5
    9748 3843 9967 3843 9967 3851 9748 3851 9748 3843
2 3 0 0 215 215 10 0 20 0.000 0 0 0 0 0 5
    9748 3851 9967 3851 9967 3859 9748 3859 9748 3851
2 3 0 0 214 214 10 0 20 0.000 0 0 0 0 0 5
    9748 3859 9967 3859 9967 3867 9748 3867 9748 3859
2 3 0 0 213 213 10 0 20 0.000 0 0 0 0 0 5
    9748 3867 9967 3867 9967 3875 9748 3875 9748 3867
2 3 0 0 212 212 10 0 20 0.000 0 0 0 0 0 5
    9748 3875 9967 3875 9967 3883 9748 3883 9748 3875
2 3 0 0 211 211 10 0 20 0.000 0 0 0 0 0 5
    9748 3883 9967 3883 9967 3891 9748 3891 9748 3883
2 3 0 0 210 210 10 0 20 0.000 0 0 0 0 0 5
    9748 3891 9967 3891 9967 3899 9748 3899 9748 3891
2 3 0 0 209 209 10 0 20 0.000 0 0 0 0 0 5
    9748 3899 9967 3899 9967 3907 9748 3907 9748 3899
2 3 0 0 208 208 10 0 20 0.000 0 0 0 0 0 5
    9748 3907 9967 3907 9967 3915 9748 3915 9748 3907
2 3 0 0 207 207 10 0 20 0.000 0 0 0 0 0 5
    9748 3915 9967 3915 9967 3923 9748 3923 9748 3915
2 3 0 0 206 206 10 0 20 0.000 0 0 0 0 0 5
    9748 3923 9967 3923 9967 3931 9748 3931 9748 3923
2 3 0 0 205 205 10 0 20 0.000 0 0 0 0 0 5
    9748 3931 9967 3931 9967 3939 9748 3939 9748 3931
2 3 0 0 204 204 10 0 20 0.000 0 0 0 0 0 5
    9748 3939 9967 3939 9967 3947 9748 3947 9748 3939
2 3 0 0 203 203 10 0 20 0.000 0 0 0 0 0 5
    9748 3947 9967 3947 9967 3955 9748 3955 9748 3947
2 3 0 0 202 202 10 0 20 0.000 0 0 0 0 0 5
    9748 3955 9967 3955 9967 3963 9748 3963 9748 3955
2 3 0 0 201 201 10 0 20 0.000 0 0 0 0 0 5
    9748 3963 9967 3963 9967 3971 9748 3971 9748 3963
2 3 0 0 200 200 10 0 20 0.000 0 0 0 0 0 5
    9748 3971 9967 3971 9967 3979 9748 3979 9748 3971
2 3 0 0 199 199 10 0 20 0.000 0 0 0 0 0 5
    9748 3979 9967 3979 9967 3987 9748 3987 9748 3979
2 3 0 0 198 198 10 0 20 0.000 0 0 0 0 0 5
    9748 3987 9967 3987 9967 3995 9748 3995 9748 3987
2 3 0 0 197 197 10 0 20 0.000 0 0 0 0 0 5
    9748 3995 9967 3995 9967 4003 9748 4003 9748 3995
2 3 0 0 196 196 10 0 20 0.000 0 0 0 0 0 5
    9748 4003 9967 4003 9967 4011 9748 4011 9748 4003
2 3 0 0 195 195 10 0 20 0.000 0 0 0 0 0 5
    9748 4011 9967 4011 9967 4019 9748 4019 9748 4011
2 3 0 0 194 194 10 0 20 0.000 0 0 0 0 0 5
    9748 4019 9967 4019 9967 4027 9748 4027 9748 4019
2 3 0 0 193 193 10 0 20 0.000 0 0 0 0 0 5
    9748 4027 9967 4027 9967 4035 9748 4035 9748 4027
2 3 0 0 192 192 10 0 20 0.000 0 0 0 0 0 5
    9748 4035 9967 4035 9967 4043 9748 4043 9748 4035
2 3 0 0 191 191 10 0 20 0.000 0 0 0 0 0 5
    9748 4043 9967 4043 9967 4051 9748 4051 9748 4043
2 3 0 0 190 190 10 0 20 0.000 0 0 0 0 0 5
    9748 4051 9967 4051 9967 4059 9748 4059 9748 4051
2 3 0 0 189 189 10 0 20 0.000 0 0 0 0 0 5
    9748 4059 9967 4059 9967 4067 9748 4067 9748 4059
2 3 0 0 188 188 10 0 20 0.000 0 0 0 0 0 5
    9748 4067 9967 4067 9967 4075 9748 4075 9748 4067
2 3 0 0 187 187 10 0 20 0.000 0 0 0 0 0 5
    9748 4075 9967 4075 9967 4083 9748 4083 9748 4075
2 3 0 0 186 186 10 0 20 0.000 0 0 0 0 0 5
    9748 4083 9967 4083 9967 4091 9748 4091 9748 4083
2 3 0 0 185 185 10 0 20 0.000 0 0 0 0 0 5
    9748 4091 9967 4091 9967 4099 9748 4099 9748 4091
2 3 0 0 184 184 10 0 20 0.000 0 0 0 0 0 5
    9748 4099 9967 4099 9967 4107 9748 4107 9748 4099
2 3 0 0 183 183 10 0 20 0.000 0 0 0 0 0 5
    9748 4107 9967 4107 9967 4115 9748 4115 9748 4107
2 3 0 0 182 182 10 0 20 0.000 0 0 0 0 0 5
    9748 4115 9967 4115 9967 4123 9748 4123 9748 4115
2 3 0 0 181 181 10 0 20 0.000 0 0 0 0 0 5
    9748 4123 9967 4123 9967 4131 9748 4131 9748 4123
2 3 0 0 180 180 10 0 20 0.000 0 0 0 0 0 5
    9748 4131 9967 4131 9967 4139 9748 4139 9748 4131
2 3 0 0 179 179 10 0 20 0.000 0 0 0 0 0 5
    9748 4139 9967 4139 9967 4147 9748 4147 9748 4139
2 3 0 0 178 178 10 0 20 0.000 0 0 0 0 0 5
    9748 4147 9967 4147 9967 4155 9748 4155 9748 4147
2 3 0 0 177 177 10 0 20 0.000 0 0 0 0 0 5
    9748 4155 9967 4155 9967 4163 9748 4163 9748 4155
2 3 0 0 176 176 10 0 20 0.000 0 0 0 0 0 5
    9748 4163 9967 4163 9967 4171 9748 4171 9748 4163
2 3 0 0 175 175 10 0 20 0.000 0 0 0 0 0 5
    9748 4171 9967 4171 9967 4179 9748 4179 9748 4171
2 3 0 0 174 174 10 0 20 0.000 0 0 0 0 0 5
    9748 4179 9967 4179 9967 4187 9748 4187 9748 4179
2 3 0 0 173 173 10 0 20 0.000 0 0 0 0 0 5
    9748 4187 9967 4187 9967 4195 9748 4195 9748 4187
2 3 0 0 172 172 10 0 20 0.000 0 0 0 0 0 5
    9748 4195 9967 4195 9967 4203 9748 4203 9748 4195
2 3 0 0 171 171 10 0 20 0.000 0 0 0 0 0 5
    9748 4203 9967 4203 9967 4211 9748 4211 9748 4203
2 3 0 0 170 170 10 0 20 0.000 0 0 0 0 0 5
    9748 4211 9967 4211 9967 4219 9748 4219 9748 4211
EOF1

}

sub dumpTail {

print <<"EOF2";
4 2 -1 0 0 16 10 0.0000 4 120 360 9650 2750 <${temp7}C\\001
4 2 -1 0 0 16 10 0.0000 4 120 360 9650 3000 ${temp6}C\\001
4 2 -1 0 0 16 10 0.0000 4 120 360 9650 3250 ${temp5}C\\001
4 2 -1 0 0 16 10 0.0000 4 120 360 9650 3500 ${temp4}C\\001
4 2 -1 0 0 16 10 0.0000 4 120 360 9650 3750 ${temp3}C\\001
4 2 -1 0 0 16 10 0.0000 4 120 360 9650 4000 ${temp2}C\\001
4 2 -1 0 0 16 10 0.0000 4 120 360 9650 4250 >${temp1}C\\001
EOF2

}

sub main {

    open (FILE, "<$ARGV[@ARGV-1]") || die("error: file $ARGV[@ARGV-1] could not be opened\n");
    my $maxfig = 0;
    my $minfig = -1;
    my $figinput = 0;
    while (<FILE>) {
	if (/FIG starts/) {
	    $figinput = 1;
	    last;
	}
    }

    # This is a HotSpot floorplan file and not an output of print_flp_fig. 
    # So let us generate the print_flp_fig output ourselves and save it in a 
    # temporary file.

    my $file = "$ARGV[@ARGV-1]" . time();

    if (!$figinput) {
	seek(FILE, 0, 0);
	open(NEWFILE, ">$file") || die("error: file $file could not be created\n");
	print(NEWFILE "FIG starts\n");
	while (<FILE>) {
		# skip comments and empty lines
		next if (/^\s*#|^\s*$/);
		chomp;
		my @strs = split(/\s+/);
		die ("error: wrong floorplan input format\n") if (@strs != 3 && @strs != 5);
		# skip connectivity information
		next if (@strs == 3);
		my ($name, $width, $height, $leftx, $bottomy) = @strs;
		my $rightx = $leftx + $width;
		my $topy = $bottomy + $height;
		printf(NEWFILE "%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n", 
			    $leftx, $bottomy, $leftx, $topy, $rightx, $topy, $rightx, $bottomy, 
				$leftx, $bottomy);
		printf(NEWFILE "%s\n", $name);
	}
	print(NEWFILE "FIG ends\n");
	close(NEWFILE);
	close(FILE);
	open(FILE, "<$file") || die("error: file $file could not be opened\n");
	while (<FILE>) {
		last if (/FIG starts/);
	}	
    }

    my $pos=tell(FILE);
    my $j=0; 
    while (<FILE>) {
	last if (/FIG ends/);
	next if (/[a-zA-Z_]|^\s*$/);
	chomp;
	my @nums = split(/\s+/);
	for (my $i=0; $i < @nums; $i++) {
	    die("error: negative co-ordinate found\n") if ($nums[$i] < 0);
	    $maxfig = $nums[$i] if ($nums[$i] > $maxfig);
	    $minfig = $nums[$i] if ($nums[$i] < $minfig || $minfig == -1);
	}
    }
    
    my $maxx = 9600;
    my $maxy = 12600;
    
    $maxfig-=$minfig;
    my $scale = (($maxx < $maxy)?$maxx:$maxy) / $maxfig * sqrt(0.95);
    my $xorig = ($maxx-$maxfig*$scale)/2;
    my $yorig = ($maxy-$maxfig*$scale)/2;
    
    print <<"EOF";
#FIG 3.1
Portrait
Center
Inches
1200 2
EOF
    dumpHeader() if ($op_temp);

    seek(FILE, $pos, 0);

    my $j=0;
    while (<FILE>) {
	last if (/FIG ends/);
	chomp;
	my @coords = split(/\s+/);
	next if ($#coords == -1);
	@coords = map($_-$minfig, @coords);
	@coords = map($_*$scale, @coords);

	my $leftx   = $coords[0];
	my $rightx  = $coords[0];
	my $bottomy = $coords[1];
	my $topy    = $coords[1];
	for(my $i=2; $i < @coords; $i++) {
	    if ($i % 2) {
		$bottomy = $coords[$i] if ($coords[$i] < $bottomy);
		$topy = $coords[$i] if ($coords[$i] > $topy);
	    } else {
		$leftx = $coords[$i] if ($coords[$i] < $leftx);
		$rightx = $coords[$i] if ($coords[$i] > $rightx);
	    }
	}

	for (my $i=0; $i < @coords; $i++) {
	    if ($i % 2) {
		$coords[$i] = int($maxy - $coords[$i] - $yorig);
	    } else {
		$coords[$i] = int($coords[$i] + $xorig);
	    }	
	}
	my $name = <FILE>;
	chomp($name);

	my $xpos = int($xorig + ($leftx + $rightx) / 2.0);
	my $ypos = int($maxy - ($bottomy + $topy) / 2.0 - $yorig);

	if ($op_temp) {
	    # Color fill
# 	    printf STDERR "${name} Power=" . $moduleMaxTemp{$name} . ":";
# 	    $moduleMaxTemp{$name} /= ($xpos*$ypos);
# 	    $moduleMaxTemp{$name} *= 10e12;
# 	    printf STDERR "density=" . $moduleMaxTemp{$name} . "\n";
	     
	    printf STDERR "${name} " . $moduleMaxTemp{$name} . "C is color " . calcColor($moduleMaxTemp{$name}) ."\n";
	    printf("2 2 0 1 -1 %d 1 0 20 0.000 0 0 0 0 0 %d\n", calcColor($moduleMaxTemp{$name}), int (@coords)/2);
	}else{
	    # No fill
	    printf("2 2 0 1 -1 7 0 0 -1 0.000 0 0 0 0 0 %d\n", int (@coords)/2);
	}
	print "\t@coords\n";
	my $angle = 0;
	my $angle = 1.5708 if (($topy - $bottomy) > 5 * ($rightx - $leftx));
	print "4 1 -1 0 0 0 $op_fontsize 0 4 -1 -1 $xpos $ypos $name\\001\n";
    }

    dumpTail() if ($op_temp);

    close(FILE);

    # delete the temporary file created
    unlink ($file) if (!$figinput); 
}
